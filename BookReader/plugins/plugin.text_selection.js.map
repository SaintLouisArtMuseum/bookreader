{"version":3,"file":"plugins/plugin.text_selection.js","mappings":"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","sources":["webpack://@internetarchive/bookreader/./src/BookReader/utils/SelectionObserver.js","webpack://@internetarchive/bookreader/./src/util/strings.js","webpack://@internetarchive/bookreader/./src/plugins/plugin.text_selection.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/string-trim-forced.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.string.trim.js"],"sourcesContent":["// @ts-check\r\nexport class SelectionObserver {\r\n  selecting = false;\r\n  startedInSelector = false;\r\n  /** @type {HTMLElement} */\r\n  target = null;\r\n\r\n  /**\r\n   * @param {string} selector\r\n   * @param {function('started' | 'cleared', HTMLElement): any} handler\r\n   */\r\n  constructor(selector, handler) {\r\n    this.selector = selector;\r\n    this.handler = handler;\r\n  }\r\n\r\n  attach() {\r\n    // We can't just use selectstart, because safari on iOS just\r\n    // randomly decides when to fire it 😤\r\n    // document.addEventListener(\"selectstart\", this._onSelectStart);\r\n    // This has to be on document :/\r\n    document.addEventListener(\"selectionchange\", this._onSelectionChange);\r\n  }\r\n\r\n  detach() {\r\n    document.removeEventListener(\"selectionchange\", this._onSelectionChange);\r\n  }\r\n\r\n  _onSelectionChange = () => {\r\n    const sel = window.getSelection();\r\n\r\n    if (!this.selecting && sel.toString()) {\r\n      const target = $(sel.anchorNode).closest(this.selector)[0];\r\n      if (!target) return;\r\n      this.target = target;\r\n      this.selecting = true;\r\n      this.handler('started', this.target);\r\n    }\r\n\r\n    if (this.selecting && (sel.isCollapsed || !sel.toString() || !$(sel.anchorNode).closest(this.selector)[0])) {\r\n      this.selecting = false;\r\n      this.handler('cleared', this.target);\r\n    }\r\n  };\r\n}\r\n","/**\r\n * @typedef {String} StringWithVars\r\n * A template string with {{foo}} style variables\r\n * Also supports filters, like {{bookPath|urlencode}} (See APPLY_FILTERS for the\r\n * supported list of filters)\r\n **/\r\n\r\n/**\r\n * @param {StringWithVars|String} template\r\n * @param { {[varName: string]: { toString: () => string} } } vars\r\n * @param { {[varName: string]: { toString: () => string} } } [overrides]\r\n */\r\nexport function applyVariables(template, vars, overrides = {}, possibleFilters = APPLY_FILTERS) {\r\n  return template?.replace(/\\{\\{([^}]*?)\\}\\}/g, ($0, $1) => {\r\n    if (!$1) return $0;\r\n    /** @type {string} */\r\n    const expression = $1;\r\n    const [varName, ...filterNames] = expression.split('|').map(x => x.trim());\r\n    const defined = varName in overrides || varName in vars;\r\n\r\n    // If it's not defined, don't expand it at all\r\n    if (!defined) return $0;\r\n\r\n    const value = varName in overrides ? overrides[varName]\r\n      : varName in vars ? vars[varName] : null;\r\n    const filters = filterNames.map(n => possibleFilters[n]);\r\n    return filters.reduce((acc, cur) => cur(acc), value && value.toString());\r\n  });\r\n}\r\n\r\n/** @type { {[filterName: String]:( string => string)} } */\r\nexport const APPLY_FILTERS = {\r\n  urlencode: encodeURIComponent,\r\n};\r\n","//@ts-check\r\nimport { createDIVPageLayer } from '../BookReader/PageContainer.js';\r\nimport { SelectionObserver } from '../BookReader/utils/SelectionObserver.js';\r\nimport { applyVariables } from '../util/strings.js';\r\n/** @typedef {import('../util/strings.js').StringWithVars} StringWithVars */\r\n/** @typedef {import('../BookReader/PageContainer.js').PageContainer} PageContainer */\r\n\r\nconst BookReader = /** @type {typeof import('../BookReader').default} */(window.BookReader);\r\n\r\nexport const DEFAULT_OPTIONS = {\r\n  enabled: true,\r\n  /** @type {StringWithVars} The URL to fetch the entire DJVU xml. Supports options.vars */\r\n  fullDjvuXmlUrl: null,\r\n  /** @type {StringWithVars} The URL to fetch a single page of the DJVU xml. Supports options.vars. Also has {{pageIndex}} */\r\n  singlePageDjvuXmlUrl: null,\r\n  /** Whether to fetch the XML as a jsonp */\r\n  jsonp: false,\r\n  override: true,\r\n};/** Add override as hacky way of disabling this plugin. Intended method with 'enabled' and options.js does not work. @TODO Find a clean way to disable text selection.  */\r\n/** @typedef {typeof DEFAULT_OPTIONS} TextSelectionPluginOptions */\r\n\r\n/**\r\n * @template T\r\n */\r\nexport class Cache {\r\n  constructor(maxSize = 10) {\r\n    this.maxSize = maxSize;\r\n    /** @type {T[]} */\r\n    this.entries = [];\r\n  }\r\n\r\n  /**\r\n   * @param {T} entry\r\n   */\r\n  add(entry) {\r\n    if (this.entries.length >= this.maxSize) {\r\n      this.entries.shift();\r\n    }\r\n    this.entries.push(entry);\r\n  }\r\n}\r\n\r\nexport class TextSelectionPlugin {\r\n  /**\r\n   * @param {'lr' | 'rl'} pageProgression In the future this should be in the ocr file\r\n   * since a book being right to left doesn't mean the ocr is right to left. But for\r\n   * now we do make that assumption.\r\n   */\r\n  constructor(options = DEFAULT_OPTIONS, optionVariables, pageProgression = 'lr') {\r\n    this.options = options;\r\n    if (this.options.override === true) return;\r\n    this.optionVariables = optionVariables;\r\n    /**@type {PromiseLike<JQuery<HTMLElement>|undefined>} */\r\n    this.djvuPagesPromise = null;\r\n    /** Whether the book is right-to-left */\r\n    this.rtl = pageProgression === 'rl';\r\n\r\n    /** @type {Cache<{index: number, response: any}>} */\r\n    this.pageTextCache = new Cache();\r\n\r\n    /**\r\n     * Sometimes there are too many words on a page, and the browser becomes near\r\n     * unusable. For now don't render text layer for pages with too many words.\r\n     */\r\n    this.maxWordRendered = 2500;\r\n\r\n    this.selectionObserver = new SelectionObserver('.BRtextLayer', this._onSelectionChange);\r\n  }\r\n\r\n  /**\r\n   * @param {'started' | 'cleared'} type\r\n   * @param {HTMLElement} target\r\n   */\r\n  _onSelectionChange = (type, target) => {\r\n    if (type === 'started') {\r\n      this.textSelectingMode(target);\r\n    } else if (type === 'cleared') {\r\n      this.defaultMode(target);\r\n    } else {\r\n      throw new Error(`Unknown type ${type}`);\r\n    }\r\n  }\r\n\r\n  init() {\r\n    if(this.selectionObserver != null || this.selectionObserver != undefined) { \r\n      this.selectionObserver.attach();\r\n    }\r\n\r\n    // Only fetch the full djvu xml if the single page url isn't there\r\n    if (this.options.singlePageDjvuXmlUrl) return;\r\n    this.djvuPagesPromise = $.ajax({\r\n      type: \"GET\",\r\n      url: applyVariables(this.options.fullDjvuXmlUrl, this.optionVariables),\r\n      dataType: this.options.jsonp ? \"jsonp\" : \"html\",\r\n      cache: true,\r\n      error: (e) => undefined\r\n    }).then((res) => {\r\n      try {\r\n        const xmlMap = $.parseXML(res);\r\n        return xmlMap && $(xmlMap).find(\"OBJECT\");\r\n      } catch (e) {\r\n        return undefined;\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {number} index\r\n   * @returns {Promise<HTMLElement|undefined>}\r\n   */\r\n  async getPageText(index) {\r\n    if (this.options.singlePageDjvuXmlUrl && this.options.override === false) {\r\n      const cachedEntry = this.pageTextCache.entries.find(x => x.index == index);\r\n      if (cachedEntry) {\r\n        return cachedEntry.response;\r\n      }\r\n      const res = await $.ajax({\r\n        type: \"GET\",\r\n        url: applyVariables(this.options.singlePageDjvuXmlUrl, this.optionVariables, { pageIndex: index }),\r\n        dataType: this.options.jsonp ? \"jsonp\" : \"html\",\r\n        cache: true,\r\n        error: (e) => undefined,\r\n      });\r\n      try {\r\n        const xmlDoc = $.parseXML(res);\r\n        const result = xmlDoc && $(xmlDoc).find(\"OBJECT\")[0];\r\n        this.pageTextCache.add({ index, response: result });\r\n        return result;\r\n      } catch (e) {\r\n        return undefined;\r\n      }\r\n    } else {\r\n      const XMLpagesArr = await this.djvuPagesPromise;\r\n      if (XMLpagesArr) return XMLpagesArr[index];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Intercept copied text to remove any styling applied to it\r\n   * @param {JQuery} $container\r\n   */\r\n  interceptCopy($container) {\r\n    $container[0].addEventListener('copy', (event) => {\r\n      const selection = document.getSelection();\r\n      event.clipboardData.setData('text/plain', selection.toString());\r\n      event.preventDefault();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Applies mouse events when in default mode\r\n   * @param {HTMLElement} textLayer\r\n   */\r\n  defaultMode(textLayer) {\r\n    const $pageContainer = $(textLayer).closest('.BRpagecontainer');\r\n    textLayer.style.pointerEvents = \"none\";\r\n    $pageContainer.find(\"img\").css(\"pointer-events\", \"auto\");\r\n\r\n    $(textLayer).off(\".textSelectPluginHandler\");\r\n    const startedMouseDown = this.mouseIsDown;\r\n    let skipNextMouseup = this.mouseIsDown;\r\n    if (startedMouseDown) {\r\n      textLayer.style.pointerEvents = \"auto\";\r\n    }\r\n\r\n    // Need to stop propagation to prevent DragScrollable from\r\n    // blocking selection\r\n    $(textLayer).on(\"mousedown.textSelectPluginHandler\", (event) => {\r\n      this.mouseIsDown = true;\r\n      if ($(event.target).is(\".BRwordElement, .BRspace\")) {\r\n        event.stopPropagation();\r\n      }\r\n    });\r\n\r\n    $(textLayer).on(\"mouseup.textSelectPluginHandler\", (event) => {\r\n      this.mouseIsDown = false;\r\n      textLayer.style.pointerEvents = \"none\";\r\n      if (skipNextMouseup) {\r\n        skipNextMouseup = false;\r\n        event.stopPropagation();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * This mode is active while there is a selection on the given textLayer\r\n   * @param {HTMLElement} textLayer\r\n   */\r\n  textSelectingMode(textLayer) {\r\n    const $pageContainer = $(textLayer).closest('.BRpagecontainer');\r\n    // Make text layer consume all events\r\n    textLayer.style.pointerEvents = \"all\";\r\n    // Block img from getting long-press to save while selecting\r\n    $pageContainer.find(\"img\").css(\"pointer-events\", \"none\");\r\n\r\n    $(textLayer).off(\".textSelectPluginHandler\");\r\n\r\n    $(textLayer).on('mousedown.textSelectPluginHandler', (event) => {\r\n      this.mouseIsDown = true;\r\n      event.stopPropagation();\r\n    });\r\n\r\n    // Prevent page flip on click\r\n    $(textLayer).on('mouseup.textSelectPluginHandler', (event) => {\r\n      this.mouseIsDown = false;\r\n      event.stopPropagation();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Initializes text selection modes if there is a text layer on the page\r\n   * @param {JQuery} $container\r\n   */\r\n  stopPageFlip($container) {\r\n    /** @type {JQuery<HTMLElement>} */\r\n    const $textLayer = $container.find('.BRtextLayer');\r\n    if (!$textLayer.length) return;\r\n    $textLayer.each((i, s) => this.defaultMode(s));\r\n    this.interceptCopy($container);\r\n  }\r\n\r\n  /**\r\n   * @param {PageContainer} pageContainer\r\n   */\r\n  async createTextLayer(pageContainer) {\r\n    const pageIndex = pageContainer.page.index;\r\n    const $container = pageContainer.$container;\r\n    const $textLayers = $container.find('.BRtextLayer');\r\n    if ($textLayers.length) return;\r\n    const XMLpage = await this.getPageText(pageIndex);\r\n    if (!XMLpage) return;\r\n    recursivelyAddCoords(XMLpage);\r\n\r\n    const totalWords = $(XMLpage).find(\"WORD\").length;\r\n    if (totalWords > this.maxWordRendered) {\r\n      console.log(`Page ${pageIndex} has too many words (${totalWords} > ${this.maxWordRendered}). Not rendering text layer.`);\r\n      return;\r\n    }\r\n\r\n    const textLayer = createDIVPageLayer(pageContainer.page, 'BRtextLayer');\r\n    const ratioW = parseFloat(pageContainer.$container[0].style.width) / pageContainer.page.width;\r\n    const ratioH = parseFloat(pageContainer.$container[0].style.height) / pageContainer.page.height;\r\n    textLayer.style.transform = `scale(${ratioW}, ${ratioH})`;\r\n    textLayer.setAttribute(\"dir\", this.rtl ? \"rtl\" : \"ltr\");\r\n\r\n    const ocrParagraphs = $(XMLpage).find(\"PARAGRAPH[coords]\").toArray();\r\n    const paragEls = ocrParagraphs.map(p => {\r\n      const el = this.renderParagraph(p);\r\n      textLayer.appendChild(el);\r\n      return el;\r\n    });\r\n\r\n    // Fix up paragraph positions\r\n    const paragraphRects = determineRealRects(textLayer, '.BRparagraphElement');\r\n    let yAdded = 0;\r\n    for (const [ocrParagraph, paragEl] of zip(ocrParagraphs, paragEls)) {\r\n      const ocrParagBounds = $(ocrParagraph).attr(\"coords\").split(\",\").map(parseFloat);\r\n      const realRect = paragraphRects.get(paragEl);\r\n      const [ocrLeft, , ocrRight, ocrTop] = ocrParagBounds;\r\n      const newStartMargin = this.rtl ? (realRect.right - ocrRight) : (ocrLeft - realRect.left);\r\n      const newTop = ocrTop - (realRect.top + yAdded);\r\n\r\n      paragEl.style[this.rtl ? 'marginRight' : 'marginLeft'] = `${newStartMargin}px`;\r\n      paragEl.style.marginTop = `${newTop}px`;\r\n      yAdded += newTop;\r\n      textLayer.appendChild(paragEl);\r\n    }\r\n    $container.append(textLayer);\r\n    this.stopPageFlip($container);\r\n  }\r\n\r\n  /**\r\n   * @param {HTMLElement} ocrParagraph\r\n   * @returns {HTMLParagraphElement}\r\n   */\r\n  renderParagraph(ocrParagraph) {\r\n    const paragEl = document.createElement('p');\r\n    paragEl.classList.add('BRparagraphElement');\r\n    const [paragLeft, paragBottom, paragRight, paragTop] = $(ocrParagraph).attr(\"coords\").split(\",\").map(parseFloat);\r\n    const wordHeightArr = [];\r\n    const lines = $(ocrParagraph).find(\"LINE[coords]\").toArray();\r\n    if (!lines.length) return paragEl;\r\n\r\n\r\n    for (const [prevLine, line, nextLine] of lookAroundWindow(genMap(lines, augmentLine))) {\r\n      const isLastLineOfParagraph = line.ocrElement == lines[lines.length - 1];\r\n      const lineEl = document.createElement('span');\r\n      lineEl.classList.add('BRlineElement');\r\n\r\n      for (const [wordIndex, currWord] of line.words.entries()) {\r\n        const [, bottom, right, top] = $(currWord).attr(\"coords\").split(',').map(parseFloat);\r\n        const wordHeight = bottom - top;\r\n        wordHeightArr.push(wordHeight);\r\n\r\n        if (wordIndex == 0 && prevLine?.lastWord.textContent.trim().endsWith('-')) {\r\n          // ideally prefer the next line to determine the left position,\r\n          // since the previous line could be the first line of the paragraph\r\n          // and hence have an incorrectly indented first word.\r\n          // E.g. https://archive.org/details/driitaleofdaring00bachuoft/page/360/mode/2up\r\n          const [newLeft, , , ] = $((nextLine || prevLine).firstWord).attr(\"coords\").split(',').map(parseFloat);\r\n          $(currWord).attr(\"coords\", `${newLeft},${bottom},${right},${top}`);\r\n        }\r\n\r\n        const wordEl = document.createElement('span');\r\n        wordEl.setAttribute(\"class\", \"BRwordElement\");\r\n        wordEl.textContent = currWord.textContent.trim();\r\n\r\n        if (wordIndex > 0) {\r\n          const space = document.createElement('span');\r\n          space.classList.add('BRspace');\r\n          space.textContent = ' ';\r\n          lineEl.append(space);\r\n\r\n          // Edge ignores empty elements (like BRspace), so add another\r\n          // space to ensure Edge's ReadAloud works correctly.\r\n          lineEl.appendChild(document.createTextNode(' '));\r\n        }\r\n\r\n        lineEl.appendChild(wordEl);\r\n      }\r\n\r\n      const hasHyphen = line.lastWord.textContent.trim().endsWith('-');\r\n      const lastWordEl = lineEl.children[lineEl.children.length - 1];\r\n      if (hasHyphen && !isLastLineOfParagraph) {\r\n        lastWordEl.textContent = lastWordEl.textContent.trim().slice(0, -1);\r\n        lastWordEl.classList.add('BRwordElement--hyphen');\r\n      }\r\n\r\n      paragEl.appendChild(lineEl);\r\n      if (!isLastLineOfParagraph && !hasHyphen) {\r\n        // Edge does not correctly have spaces between the lines.\r\n        paragEl.appendChild(document.createTextNode(' '));\r\n      }\r\n    }\r\n\r\n    wordHeightArr.sort((a, b) => a - b);\r\n    const paragWordHeight = wordHeightArr[Math.floor(wordHeightArr.length * 0.85)] + 4;\r\n    paragEl.style.left = `${paragLeft}px`;\r\n    paragEl.style.top = `${paragTop}px`;\r\n    paragEl.style.width = `${paragRight - paragLeft}px`;\r\n    paragEl.style.height = `${paragBottom - paragTop}px`;\r\n    paragEl.style.fontSize = `${paragWordHeight}px`;\r\n\r\n    // Fix up sizes - stretch/crush words as necessary using letter spacing\r\n    let wordRects = determineRealRects(paragEl, '.BRwordElement');\r\n    const ocrWords = $(ocrParagraph).find(\"WORD\").toArray();\r\n    const wordEls = paragEl.querySelectorAll('.BRwordElement');\r\n    for (const [ocrWord, wordEl] of zip(ocrWords, wordEls)) {\r\n      const realRect = wordRects.get(wordEl);\r\n      const [left, , right ] = $(ocrWord).attr(\"coords\").split(',').map(parseFloat);\r\n      let ocrWidth = right - left;\r\n      // Some books (eg theworksofplato01platiala) have a space _inside_ the <WORD>\r\n      // element. That makes it impossible to determine the correct positining\r\n      // of everything, but to avoid the BRspace's being width 0, which makes selection\r\n      // janky on Chrome Android, assume the space is the same width as one of the\r\n      // letters.\r\n      if (ocrWord.textContent.endsWith(' ')) {\r\n        ocrWidth = ocrWidth * (ocrWord.textContent.length - 1) / ocrWord.textContent.length;\r\n      }\r\n      const diff = ocrWidth - realRect.width;\r\n      wordEl.style.letterSpacing = `${diff / (ocrWord.textContent.length - 1)}px`;\r\n    }\r\n\r\n    // Stretch/crush lines as necessary using line spacing\r\n    // Recompute rects after letter spacing\r\n    wordRects = determineRealRects(paragEl, '.BRwordElement');\r\n    const spaceRects = determineRealRects(paragEl, '.BRspace');\r\n\r\n    const ocrLines = $(ocrParagraph).find(\"LINE[coords]\").toArray();\r\n    const lineEls = Array.from(paragEl.querySelectorAll('.BRlineElement'));\r\n\r\n    let ySoFar = paragTop;\r\n    for (const [ocrLine, lineEl] of zip(ocrLines, lineEls)) {\r\n      // shift words using marginLeft to align with the correct x position\r\n      const words = $(ocrLine).find(\"WORD\").toArray();\r\n      // const ocrLineLeft = Math.min(...words.map(w => parseFloat($(w).attr(\"coords\").split(',')[0])));\r\n      let xSoFar = this.rtl ? paragRight : paragLeft;\r\n      for (const [ocrWord, wordEl] of zip(words, lineEl.querySelectorAll('.BRwordElement'))) {\r\n        // start of line, need to compute the offset relative to the OCR words\r\n        const wordRect = wordRects.get(wordEl);\r\n        const [ocrLeft, , ocrRight ] = $(ocrWord).attr(\"coords\").split(',').map(parseFloat);\r\n        const diff = (this.rtl ? -(ocrRight - xSoFar) : ocrLeft - xSoFar);\r\n\r\n        if (wordEl.previousElementSibling) {\r\n          const space = wordEl.previousElementSibling;\r\n          space.style.letterSpacing = `${diff - spaceRects.get(space).width}px`;\r\n        } else {\r\n          wordEl.style[this.rtl ? 'paddingRight' : 'paddingLeft'] = `${diff}px`;\r\n        }\r\n        if (this.rtl) xSoFar -= diff + wordRect.width;\r\n        else xSoFar += diff + wordRect.width;\r\n      }\r\n      // And also fix y position\r\n      const ocrLineTop = Math.min(...words.map(w => parseFloat($(w).attr(\"coords\").split(',')[3])));\r\n      const diff = ocrLineTop - ySoFar;\r\n      if (lineEl.previousElementSibling) {\r\n        lineEl.previousElementSibling.style.lineHeight = `${diff}px`;\r\n        ySoFar += diff;\r\n      }\r\n    }\r\n\r\n    // The last line will have a line height subtracting from the paragraph height\r\n    lineEls[lineEls.length - 1].style.lineHeight = `${paragBottom - ySoFar}px`;\r\n\r\n    // Edge does not include a newline for some reason when copying/pasting the <p> els\r\n    paragEl.appendChild(document.createElement('br'));\r\n    return paragEl;\r\n  }\r\n}\r\n\r\nexport class BookreaderWithTextSelection extends BookReader {\r\n  init() {\r\n    const options = Object.assign({}, DEFAULT_OPTIONS, this.options.plugins.textSelection);\r\n    if (options.enabled) {\r\n      this.textSelectionPlugin = new TextSelectionPlugin(options, this.options.vars, this.pageProgression);\r\n      // Write this back; this way the plugin is the source of truth, and BR just\r\n      // contains a reference to it.\r\n      this.options.plugins.textSelection = options;\r\n      this.textSelectionPlugin.init();\r\n\r\n      new SelectionObserver('.BRtextLayer', (selectEvent) => {\r\n        // Track how often selection is used\r\n        if (selectEvent == 'started') {\r\n          this.archiveAnalyticsSendEvent?.('BookReader', 'SelectStart');\r\n\r\n          // Set a class on the page to avoid hiding it when zooming/etc\r\n          this.refs.$br.find('.BRpagecontainer--hasSelection').removeClass('BRpagecontainer--hasSelection');\r\n          $(window.getSelection().anchorNode).closest('.BRpagecontainer').addClass('BRpagecontainer--hasSelection');\r\n        }\r\n      }).attach();\r\n    }\r\n\r\n    super.init();\r\n  }\r\n\r\n  /**\r\n   * @param {number} index\r\n   */\r\n  _createPageContainer(index) {\r\n    const pageContainer = super._createPageContainer(index);\r\n    // Disable if thumb mode; it's too janky\r\n    // .page can be null for \"pre-cover\" region\r\n    if (this.mode !== this.constModeThumb && pageContainer.page) {\r\n      this.textSelectionPlugin?.createTextLayer(pageContainer);\r\n    }\r\n    return pageContainer;\r\n  }\r\n}\r\nwindow.BookReader = BookreaderWithTextSelection;\r\nexport default BookreaderWithTextSelection;\r\n\r\n\r\n/**\r\n * @param {HTMLElement} parentEl\r\n * @param {string} selector\r\n * @returns {Map<Element, Rect>}\r\n */\r\nfunction determineRealRects(parentEl, selector) {\r\n  const initals = {\r\n    position: parentEl.style.position,\r\n    visibility: parentEl.style.visibility,\r\n    top: parentEl.style.top,\r\n    left: parentEl.style.left,\r\n    transform: parentEl.style.transform,\r\n  };\r\n  parentEl.style.position = 'absolute';\r\n  parentEl.style.visibility = 'hidden';\r\n  parentEl.style.top = '0';\r\n  parentEl.style.left = '0';\r\n  parentEl.style.transform = 'none';\r\n  document.body.appendChild(parentEl);\r\n  const rects = new Map(\r\n    Array.from(parentEl.querySelectorAll(selector))\r\n      .map(wordEl => {\r\n        const origRect = wordEl.getBoundingClientRect();\r\n        return [wordEl, new Rect(\r\n          origRect.left + window.scrollX,\r\n          origRect.top + window.scrollY,\r\n          origRect.width,\r\n          origRect.height,\r\n        )];\r\n      })\r\n  );\r\n  document.body.removeChild(parentEl);\r\n  Object.assign(parentEl.style, initals);\r\n  return rects;\r\n}\r\n\r\n/**\r\n * @param {HTMLElement} line\r\n */\r\nfunction augmentLine(line) {\r\n  const words = $(line).find(\"WORD\").toArray();\r\n  return {\r\n    ocrElement: line,\r\n    words,\r\n    firstWord: words[0],\r\n    lastWord: words[words.length - 1],\r\n  };\r\n}\r\n\r\n/**\r\n * @template TFrom, TTo\r\n * Generator version of map\r\n * @param {Iterable<TFrom>} gen\r\n * @param {function(TFrom): TTo} fn\r\n * @returns {Iterable<TTo>}\r\n */\r\nexport function* genMap(gen, fn) {\r\n  for (const x of gen) yield fn(x);\r\n}\r\n\r\n/**\r\n * @template T\r\n * Generator that provides a sliding window of 3 elements,\r\n * prev, current, and next.\r\n * @param {Iterable<T>} gen\r\n * @returns {Iterable<[T | undefined, T, T | undefined]>}\r\n */\r\nexport function* lookAroundWindow(gen) {\r\n  let prev = undefined;\r\n  let cur = undefined;\r\n  let next = undefined;\r\n  for (const x of gen) {\r\n    if (typeof cur !== 'undefined') {\r\n      next = x;\r\n      yield [prev, cur, next];\r\n    }\r\n    prev = cur;\r\n    cur = x;\r\n    next = undefined;\r\n  }\r\n\r\n  if (typeof cur !== 'undefined') {\r\n    yield [prev, cur, next];\r\n  }\r\n}\r\n\r\n/**\r\n * @template T1, T2\r\n * Lazy zip implementation to avoid importing lodash\r\n * Expects iterators to be of the same length\r\n * @param {Iterable<T1>} gen1\r\n * @param {Iterable<T2>} gen2\r\n * @returns {Iterable<[T1, T2]>}\r\n */\r\nexport function* zip(gen1, gen2) {\r\n  const it1 = gen1[Symbol.iterator]();\r\n  const it2 = gen2[Symbol.iterator]();\r\n  while (true) {\r\n    const r1 = it1.next();\r\n    const r2 = it2.next();\r\n    if (r1.done && r2.done) {\r\n      return;\r\n    }\r\n    if (r1.done || r2.done) {\r\n      throw new Error('zip: one of the iterators is done');\r\n    }\r\n    yield [r1.value, r2.value];\r\n  }\r\n}\r\n\r\n/**\r\n * [left, bottom, right, top]\r\n * @param {Array<[number, number, number, number]>} bounds\r\n * @returns {[number, number, number, number]}\r\n */\r\nfunction determineBounds(bounds) {\r\n  let leftMost = Infinity;\r\n  let bottomMost = -Infinity;\r\n  let rightMost = -Infinity;\r\n  let topMost = Infinity;\r\n\r\n  for (const [left, bottom, right, top] of bounds) {\r\n    leftMost = Math.min(leftMost, left);\r\n    bottomMost = Math.max(bottomMost, bottom);\r\n    rightMost = Math.max(rightMost, right);\r\n    topMost = Math.min(topMost, top);\r\n  }\r\n\r\n  return [leftMost, bottomMost, rightMost, topMost];\r\n}\r\n\r\n/**\r\n * Recursively traverses the XML tree and adds coords\r\n * which are the bounding box of all child coords\r\n * @param {Element} xmlEl\r\n */\r\nfunction recursivelyAddCoords(xmlEl) {\r\n  if ($(xmlEl).attr('coords') || !xmlEl.children) {\r\n    return;\r\n  }\r\n\r\n  const children = $(xmlEl).children().toArray();\r\n  if (children.length === 0) {\r\n    return;\r\n  }\r\n\r\n  for (const child of children) {\r\n    recursivelyAddCoords(child);\r\n  }\r\n\r\n  const childCoords = [];\r\n\r\n  for (const child of children) {\r\n    if (!$(child).attr('coords')) continue;\r\n    childCoords.push($(child).attr('coords').split(',').map(parseFloat));\r\n  }\r\n\r\n  const boundingCoords = determineBounds(childCoords);\r\n  if (Math.abs(boundingCoords[0]) != Infinity) {\r\n    $(xmlEl).attr('coords', boundingCoords.join(','));\r\n  }\r\n}\r\n\r\n/**\r\n * Basically a polyfill for the native DOMRect class\r\n */\r\nclass Rect {\r\n  /**\r\n   * @param {number} x\r\n   * @param {number} y\r\n   * @param {number} width\r\n   * @param {number} height\r\n   */\r\n  constructor(x, y, width, height) {\r\n    this.x = x;\r\n    this.y = y;\r\n    this.width = width;\r\n    this.height = height;\r\n  }\r\n\r\n  get right() { return this.x + this.width; }\r\n  get bottom() { return this.y + this.height; }\r\n  get top() { return this.y; }\r\n  get left() { return this.x; }\r\n}\r\n","'use strict';\nvar PROPER_FUNCTION_NAME = require('../internals/function-name').PROPER;\nvar fails = require('../internals/fails');\nvar whitespaces = require('../internals/whitespaces');\n\nvar non = '\\u200B\\u0085\\u180E';\n\n// check that a method works with the correct list\n// of whitespaces and has a correct name\nmodule.exports = function (METHOD_NAME) {\n  return fails(function () {\n    return !!whitespaces[METHOD_NAME]()\n      || non[METHOD_NAME]() !== non\n      || (PROPER_FUNCTION_NAME && whitespaces[METHOD_NAME].name !== METHOD_NAME);\n  });\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar $trim = require('../internals/string-trim').trim;\nvar forcedStringTrimMethod = require('../internals/string-trim-forced');\n\n// `String.prototype.trim` method\n// https://tc39.es/ecma262/#sec-string.prototype.trim\n$({ target: 'String', proto: true, forced: forcedStringTrimMethod('trim') }, {\n  trim: function trim() {\n    return $trim(this);\n  }\n});\n"],"names":["SelectionObserver","selector","handler","_this","_classCallCheck","_defineProperty","sel","window","getSelection","selecting","toString","target","$","anchorNode","closest","isCollapsed","this","key","value","document","addEventListener","_onSelectionChange","removeEventListener","applyVariables","template","vars","overrides","arguments","length","undefined","possibleFilters","APPLY_FILTERS","replace","$0","$1","_expression$split$map2","split","map","x","trim","varName","filterNames","slice","n","reduce","acc","cur","urlencode","encodeURIComponent","genMap","_marked2","_regeneratorRuntime","mark","lookAroundWindow","_marked3","zip","_callSuper","t","o","e","_getPrototypeOf","_typeof","TypeError","ReferenceError","_assertThisInitialized","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","constructor","apply","Boolean","prototype","valueOf","call","_get","get","bind","r","p","hasOwnProperty","_superPropBase","Object","getOwnPropertyDescriptor","setPrototypeOf","getPrototypeOf","__proto__","_setPrototypeOf","_slicedToArray","Array","isArray","_arrayWithHoles","l","Symbol","iterator","i","u","a","f","next","done","push","return","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","_createForOfIteratorHelper","_n","F","s","_arrayLikeToArray","name","from","test","defineProperty","c","asyncIterator","toStringTag","define","enumerable","configurable","writable","wrap","Generator","create","Context","makeInvokeMethod","tryCatch","type","arg","h","y","GeneratorFunction","GeneratorFunctionPrototype","d","v","values","g","defineIteratorMethods","forEach","_invoke","AsyncIterator","invoke","resolve","__await","then","callInvokeWithMethodAndArg","Error","method","delegate","maybeInvokeDelegate","sent","_sent","dispatchException","abrupt","resultName","nextLoc","pushTryEntry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","reset","isNaN","displayName","isGeneratorFunction","awrap","async","Promise","keys","reverse","pop","prev","charAt","stop","rval","handle","complete","finish","catch","delegateYield","asyncGeneratorStep","_asyncToGenerator","_next","_throw","_defineProperties","_toPropertyKey","_createClass","toPrimitive","String","_toPrimitive","BookReader","DEFAULT_OPTIONS","enabled","fullDjvuXmlUrl","singlePageDjvuXmlUrl","jsonp","override","Cache","maxSize","entries","entry","shift","TextSelectionPlugin","options","optionVariables","pageProgression","textSelectingMode","concat","defaultMode","djvuPagesPromise","rtl","pageTextCache","maxWordRendered","selectionObserver","attach","ajax","url","dataType","cache","error","res","xmlMap","parseXML","find","_getPageText","_callee","index","cachedEntry","xmlDoc","result","XMLpagesArr","_context","response","pageIndex","add","t0","_x","$container","event","selection","clipboardData","setData","preventDefault","textLayer","_this2","$pageContainer","style","pointerEvents","css","off","startedMouseDown","mouseIsDown","skipNextMouseup","on","is","stopPropagation","_this3","_this4","$textLayer","each","interceptCopy","_createTextLayer","_callee2","pageContainer","XMLpage","totalWords","ratioW","ratioH","ocrParagraphs","paragEls","paragraphRects","yAdded","_iterator","_step","_step$value","ocrParagraph","paragEl","ocrParagBounds","realRect","_ocrParagBounds","ocrLeft","ocrRight","ocrTop","newStartMargin","newTop","_this5","_context2","page","getPageText","recursivelyAddCoords","console","log","createDIVPageLayer","parseFloat","width","height","transform","setAttribute","toArray","el","renderParagraph","appendChild","determineRealRects","attr","right","left","top","marginTop","err","append","stopPageFlip","_x2","createElement","classList","_$$attr$split$map2","paragLeft","paragBottom","paragRight","paragTop","wordHeightArr","lines","_step2","_iterator2","augmentLine","_step2$value","prevLine","line","nextLine","isLastLineOfParagraph","ocrElement","lineEl","_step5","_iterator5","words","_step5$value","wordIndex","currWord","_$$attr$split$map4","bottom","wordHeight","lastWord","textContent","endsWith","newLeft","firstWord","wordEl","space","createTextNode","hasHyphen","lastWordEl","children","sort","b","paragWordHeight","Math","floor","fontSize","_step3","wordRects","_iterator3","querySelectorAll","_step3$value","ocrWord","_$$attr$split$map8","ocrWidth","diff","letterSpacing","_step4","spaceRects","ocrLines","lineEls","ySoFar","_iterator4","_step6","_step4$value","ocrLine","xSoFar","_iterator6","_step6$value","wordRect","_$$attr$split$map10","previousElementSibling","min","_arrayWithoutHoles","w","_iterableToArray","_nonIterableSpread","lineHeight","BookreaderWithTextSelection","_BookReader","_inherits","_this6","assign","plugins","textSelection","textSelectionPlugin","init","selectEvent","_this6$archiveAnalyti","archiveAnalyticsSendEvent","refs","$br","removeClass","addClass","_this$textSelectionPl","mode","constModeThumb","createTextLayer","parentEl","initals","position","visibility","body","rects","Map","origRect","getBoundingClientRect","Rect","scrollX","scrollY","removeChild","gen","fn","_iterator7","_step7","_context3","_marked","_iterator8","_step8","_context4","gen1","gen2","it1","it2","r1","r2","_context5","xmlEl","_step10","_iterator10","_step11","childCoords","_iterator11","child","boundingCoords","bounds","_step9","leftMost","Infinity","bottomMost","rightMost","topMost","_iterator9","_step9$value","max","determineBounds","abs","join","PROPER_FUNCTION_NAME","fails","whitespaces","module","exports","METHOD_NAME","$trim","proto","forced","forcedStringTrimMethod"],"sourceRoot":""}