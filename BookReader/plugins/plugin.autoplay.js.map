{"version":3,"file":"plugins/plugin.autoplay.js","mappings":"kKAYuCA,E,oBAPvCC,EAAOC,OAAOC,WAAWC,eAAgB,CACvCC,sBAAsB,IAMxBF,WAAWG,UAAUC,OAAkBP,EAQpCG,WAAWG,UAAUC,MAPf,SAAUC,GACfR,EAAOS,KAAKC,KAAMF,GAElBE,KAAKC,MAAY,EACjBD,KAAKE,UAAY,KACjBF,KAAKG,UAAY,GACnB,GAMFV,WAAWG,UAAUQ,KAAQ,SAASd,GACpC,OAAO,SAAUQ,GAAS,IAAAO,EAAA,KACxBf,EAAOS,KAAKC,KAAMF,GAEbE,KAAKF,QAAQH,sBAClBK,KAAKM,KAAKb,WAAWc,WAAWC,MAAM,kBAAMH,EAAKI,UAAU,GAC7D,CACF,CAP6B,CAO1BhB,WAAWG,UAAUQ,MAKxBX,WAAWG,UAAUc,uBAA0B,SAASpB,GACtD,OAAO,WAAW,IAAAqB,EAAA,KAGhB,GAFArB,EAAOS,KAAKC,MAEPA,KAAKF,QAAQH,qBAAlB,CAEA,IAAMiB,EAASZ,KAAKa,EAAE,WAEtBD,EAAOE,OAAO,SAASC,OAAM,WAE3B,OADAJ,EAAKK,cACE,CACT,IAEAJ,EAAOE,OAAO,UAAUC,OAAM,WAE5B,OADAJ,EAAKK,cACE,CACT,GAZ8C,CAahD,CACF,CAlB+C,CAkB5CvB,WAAWG,UAAUc,wBAQxBjB,WAAWG,UAAUoB,WAAa,SAASC,GAAW,IAAAC,EAAA,KACpD,GAAKlB,KAAKF,QAAQH,qBAAlB,CAEA,IAAMG,EAAUe,EAAErB,OAAO,CACvB2B,UAAWnB,KAAKmB,UAChBhB,UAAWH,KAAKG,WACfc,GAEHjB,KAAKmB,UAAyC,iBAAtBrB,EAAQqB,UAAyBrB,EAAQqB,UAAYnB,KAAKmB,UAClFnB,KAAKG,UAAyC,iBAAtBL,EAAQK,UAAyBL,EAAQK,UAAYH,KAAKG,UAClFH,KAAKoB,QAAQ3B,WAAWc,WAAWC,MAEnC,IAAIa,GAAiB,EACjBrB,KAAKsB,cAAgBtB,KAAKuB,OAC5BF,GAAiB,EACjBrB,KAAKwB,WAAWxB,KAAKsB,eAGnB,MAAQtB,KAAKE,WAKV,MAAQF,KAAKyB,iBAAoBJ,GAIpCrB,KAAK0B,KAAK,CAAEC,aAAa,IAG3B3B,KAAKa,EAAE,SAASe,OAChB5B,KAAKa,EAAE,UAAUgB,OACjB7B,KAAKE,UAAY4B,aAAY,WACvBZ,EAAKa,YAELC,KAAKC,IAAIf,EAAKgB,QAAQC,cAAejB,EAAKgB,QAAQE,gBAAkBlB,EAAKmB,KAAKC,cAAgB,EAChGpB,EAAKqB,KAAK,CAAEZ,aAAa,IAEzBT,EAAKQ,KAAK,CAAEC,aAAa,IAE7B,GAAG3B,KAAKG,YAERH,KAAKS,UAzCuC,CA2ChD,EAKAhB,WAAWG,UAAUa,SAAW,WACzBT,KAAKF,QAAQH,sBAEd,MAAQK,KAAKE,YACfsC,cAAcxC,KAAKE,WACnBF,KAAKmB,UAAY,OACjBnB,KAAKa,EAAE,UAAUe,OACjB5B,KAAKa,EAAE,SAASgB,OAChB7B,KAAKE,UAAY,KAErB,C","sources":["webpack://@internetarchive/bookreader/./src/plugins/plugin.autoplay.js"],"sourcesContent":["/*global BookReader */\r\n\r\n/**\r\n * Plugin which adds an autoplay feature. Useful for kiosk situations.\r\n */\r\njQuery.extend(BookReader.defaultOptions, {\r\n  enableAutoPlayPlugin: true\r\n});\r\n\r\n/**\r\n * @override BookReader.setup\r\n */\r\nBookReader.prototype.setup = (function(super_) {\r\n  return function (options) {\r\n    super_.call(this, options);\r\n\r\n    this.auto      = false;\r\n    this.autoTimer = null;\r\n    this.flipDelay = 5000;\r\n  };\r\n})(BookReader.prototype.setup);\r\n\r\n/**\r\n * @override BookReader.init\r\n */\r\nBookReader.prototype.init = (function(super_) {\r\n  return function (options) {\r\n    super_.call(this, options);\r\n\r\n    if (!this.options.enableAutoPlayPlugin) return;\r\n    this.bind(BookReader.eventNames.stop, () => this.autoStop());\r\n  };\r\n})(BookReader.prototype.init);\r\n\r\n/**\r\n * @override BookReader.bindNavigationHandlers\r\n */\r\nBookReader.prototype.bindNavigationHandlers = (function(super_) {\r\n  return function() {\r\n    super_.call(this);\r\n\r\n    if (!this.options.enableAutoPlayPlugin) return;\r\n\r\n    const jIcons = this.$('.BRicon');\r\n\r\n    jIcons.filter('.play').click(() => {\r\n      this.autoToggle();\r\n      return false;\r\n    });\r\n\r\n    jIcons.filter('.pause').click(() => {\r\n      this.autoToggle();\r\n      return false;\r\n    });\r\n  };\r\n})(BookReader.prototype.bindNavigationHandlers);\r\n\r\n/**\r\n * Starts autoplay mode\r\n * @param {object} overrides\r\n * @param {number} overrides.flipSpeed\r\n * @param {number} overrides.flipDelay\r\n */\r\nBookReader.prototype.autoToggle = function(overrides) {\r\n  if (!this.options.enableAutoPlayPlugin) return;\r\n\r\n  const options = $.extend({\r\n    flipSpeed: this.flipSpeed,\r\n    flipDelay: this.flipDelay\r\n  }, overrides);\r\n\r\n  this.flipSpeed = typeof options.flipSpeed === \"number\" ? options.flipSpeed : this.flipSpeed;\r\n  this.flipDelay = typeof options.flipDelay === \"number\" ? options.flipDelay : this.flipDelay;\r\n  this.trigger(BookReader.eventNames.stop);\r\n\r\n  let bComingFrom1up = false;\r\n  if (this.constMode2up != this.mode) {\r\n    bComingFrom1up = true;\r\n    this.switchMode(this.constMode2up);\r\n  }\r\n\r\n  if (null == this.autoTimer) {\r\n    // $$$ Draw events currently cause layout problems when they occur during animation.\r\n    //     There is a specific problem when changing from 1-up immediately to autoplay in RTL so\r\n    //     we workaround for now by not triggering immediate animation in that case.\r\n    //     See https://bugs.launchpad.net/gnubook/+bug/328327\r\n    if (('rl' == this.pageProgression) && bComingFrom1up) {\r\n      // don't flip immediately -- wait until timer fires\r\n    } else {\r\n      // flip immediately\r\n      this.next({ triggerStop: false });\r\n    }\r\n\r\n    this.$('.play').hide();\r\n    this.$('.pause').show();\r\n    this.autoTimer = setInterval(() => {\r\n      if (this.animating) return;\r\n\r\n      if (Math.max(this.twoPage.currentIndexL, this.twoPage.currentIndexR) >= this.book.getNumLeafs() - 1) {\r\n        this.prev({ triggerStop: false }); // $$$ really what we want?\r\n      } else {\r\n        this.next({ triggerStop: false });\r\n      }\r\n    }, this.flipDelay);\r\n  } else {\r\n    this.autoStop();\r\n  }\r\n};\r\n\r\n/**\r\n * Stop autoplay mode, allowing animations to finish\r\n */\r\nBookReader.prototype.autoStop = function() {\r\n  if (!this.options.enableAutoPlayPlugin) return;\r\n\r\n  if (null != this.autoTimer) {\r\n    clearInterval(this.autoTimer);\r\n    this.flipSpeed = 'fast';\r\n    this.$('.pause').hide();\r\n    this.$('.play').show();\r\n    this.autoTimer = null;\r\n  }\r\n};\r\n"],"names":["super_","jQuery","extend","BookReader","defaultOptions","enableAutoPlayPlugin","prototype","setup","options","call","this","auto","autoTimer","flipDelay","init","_this","bind","eventNames","stop","autoStop","bindNavigationHandlers","_this2","jIcons","$","filter","click","autoToggle","overrides","_this3","flipSpeed","trigger","bComingFrom1up","constMode2up","mode","switchMode","pageProgression","next","triggerStop","hide","show","setInterval","animating","Math","max","twoPage","currentIndexL","currentIndexR","book","getNumLeafs","prev","clearInterval"],"sourceRoot":""}